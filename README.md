# 미즈키

디스코드 서버의 채팅을 집계하고 사용자 레벨 시스템을 관리하는 봇입니다.

## 특징

### 주요 기능
- **채팅 집계**: 서버 내 사용자들의 채팅을 집계하고 순위를 매깁니다.
- **레벨링 시스템**: 채팅 활동에 따라 사용자들의 레벨을 관리합니다.
- **역할 자동 부여**: 채팅 순위와 레벨에 따라 자동으로 역할을 부여합니다.
- **연속 집계 기록**: 1등 역할을 연속으로 얻은 사용자들의 기록을 추적합니다.
- **커스텀 레벨 카드**: 사용자별 커스터마이징이 가능한 레벨 카드를 제공합니다.
- **오미쿠지(운세)**: 일본식 운세 기능을 제공합니다.
- **Tenor GIF 검색**: 채팅에서 바로 GIF를 검색하고 전송할 수 있습니다.

### 특별 기능
- **서버 인증 시스템**: 인증된 서버만 봇을 사용할 수 있습니다.
- **개인정보 보호 준수**: 한국과 일본의 개인정보 보호법을 준수합니다.
- **시각적 명령어 가이드**: 명령어 사용법을 이미지로 제공하는 메뉴얼 시스템을 갖추고 있습니다.

## 설치 방법

### 준비물
- Python 3.10 이상
- pip (Python 패키지 관리자)
- Discord 봇 토큰
- Tenor API 키 (GIF 기능 사용 시)

### 단계
1. 저장소를 클론합니다.
   ```bash
   git clone https://github.com/yourusername/chatzipbot.git
   cd chatzipbot
   ```

2. 가상환경을 생성하고 활성화합니다.
   ```bash
   python -m venv venv
   source venv/bin/activate  # Windows: venv\Scripts\activate
   ```

3. 필요한 패키지를 설치합니다.
   ```bash
   pip install -r requirements.txt
   ```

4. `.env` 파일을 생성하고 토큰을 설정합니다.
   ```
   DISCORD_TOKEN=your_discord_bot_token_here
   TENOR_API_KEY=your_tenor_api_key_here
   ```

5. 봇을 실행합니다.
   ```bash
   python bot.py
   ```

## 명령어 목록

### 일반 사용자 명령어
- `/리더보드` - 서버 내 채팅 순위를 표시합니다.
- `/레벨 [멤버]` - 자신 또는 멤버의 레벨 정보를 확인합니다.
- `/오미쿠지` - 일본식 운세를 뽑습니다.
- `/카드설정 [상단색상] [하단색상]` - 레벨 카드의 배경 색상을 설정합니다.
- `/tenor [검색어/URL]` - GIF를 검색하거나 특정 Tenor GIF를 게시합니다.
- `/랜덤gif [검색어]` - 지정한 키워드의 랜덤 GIF를 전송합니다.
- `/설명` - 모든 명령어에 대한 도움말을 표시합니다.
- `/메뉴얼` - 명령어 사용법을 이미지로 보여줍니다.

### 관리자 명령어
- `/집계 [시작일] [종료일]` - 특정 기간의 채팅을 집계하고 역할을 부여합니다.
- `/역할설정 [1등역할] [2-6등역할]` - 집계 시 부여할 역할을 설정합니다.
- `/역할제외 [추가/제거] [역할]` - 집계에서 제외할 역할을 관리합니다.
- `/연속초기화` - 모든 연속 집계 기록을 초기화합니다.
- `/레벨역할설정 [레벨] [역할]` - 특정 레벨에 도달하면 부여할 역할을 설정합니다.

### 1등 역할 전용 명령어
- `/역할색상 [색상]` - 1등 역할의 색상을 변경합니다.

### 관리자 전용 명령어
- `!list` - 인증된 서버 목록과 인증 코드를 관리합니다.

## 서버 인증 방법

1. 관리자가 봇을 초대하고 명령어를 실행하면 인증 모달이 표시됩니다.
2. 봇 관리자로부터 16자리 인증 코드를 받아야 합니다.
3. 인증 모달에서 코드를 입력하고 개인정보 처리방침에 동의해야 합니다.
4. 인증이 완료되면 서버에서 모든 봇 기능을 사용할 수 있습니다.

## 데이터베이스 구조

봇은 SQLite 데이터베이스를 사용하여 다음 정보를 저장합니다:
- 서버별 역할 설정
- 제외된 역할 목록
- 사용자별 채팅 횟수
- 메시지 기록 (30일간 보관)
- 집계 날짜
- 연속 기록
- 레벨별 역할 설정
- 사용자별 카드 설정
- 인증 코드 및 인증된 서버 목록

## 주의사항

- 메시지 데이터는 30일 후 자동 삭제됩니다.
- 봇의 모든 기능은 서버 인증 후에만 사용 가능합니다.
- 레벨 시스템은 사용자의 채팅 횟수에 기반합니다.
- 개인정보 처리방침은 https://mofucat.jp/ko/privacy-mizuki 에서 확인할 수 있습니다.

## 문제 해결

### 일반적인 문제
- **인증 코드 오류**: 코드가 정확히 16자리인지, 대소문자를 정확히 입력했는지 확인합니다.
- **명령어가 작동하지 않음**: 서버가 인증되었는지, 봇에 필요한 권한이 있는지 확인합니다.
- **데이터베이스 오류**: `reset_database.py`를 실행하여 데이터베이스를 초기화할 수 있습니다.

### 설치 문제
- PIL 라이브러리 오류: 레벨 카드 생성을 위해 필요한 추가 시스템 라이브러리를 설치합니다.
  ```bash
  # Ubuntu/Debian
  sudo apt-get install libjpeg-dev zlib1g-dev
  
  # macOS
  brew install jpeg zlib
  ```

## 라이선스 및 저작권

© 2023 mofucat.jp 모든 권리 보유.

이 프로젝트는 개인 및 비상업적 용도로만 사용할 수 있습니다.
봇의 배포 및 수정에 관한 문의는 개발자에게 문의하십시오.
